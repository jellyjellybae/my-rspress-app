# mini-react
```
## åœ¨é¡µé¢å®žçŽ° app

```js
console.log('main.js')
const dom = document.createElement('div')
dom.id = 'app'
const rootEl = document.querySelector('#root')
rootEl.append(dom)

const textNode = document.createTextNode('')
textNode.nodeValue = 'hello'
dom.append(textNode)
```
### vdom js object
type props children
```js
const el = {
  type: 'div',
  props: {
    children: [
      {
        type: 'TEXT_ELEMENT',
        props: {
          nodeValue: 'app',
          children:[]
        }
      }
    ]
  }
}
//promote
const el = {
  type: 'div',
  props: {
    children: [textEL]
  }
}
const textEL = {
  type: 'TEXT_ELEMENT',
  props: {
    nodeValue: 'app',
    children: []
  }
}
```
### ä¿®æ”¹æŠ½ç¦»ä¸€å°éƒ¨åˆ†
```js
const textEL = {
  type: 'TEXT_ELEMENT',
  props: {
    nodeValue: 'ðŸ¦‹app',
    children: []
  }
}
const el = {
  type: 'div',
  props: {
    id:'app',
    children: [textEL]
  }
}

const dom = document.createElement(el.type)
dom.id = el.props.id
const rootEl = document.querySelector('#root')
rootEl.append(dom)

const textNode = document.createTextNode('')
textNode.nodeValue = textEL.props.nodeValue
dom.append(textNode)
```
### åŠ¨æ€åˆ›å»ºDOM
```js
function createTextNode (text) {
  return {
    type: 'TEXT_ELEMENT',
    props: {
      nodeValue: text,
      children: []
    }
  }
}

function createElement (type, props, ...children) {
  return {
    type,
    props: {
      ...props,
      children
    }
  }
}
const textEl = createTextNode('ðŸ¦‹app')
const App = createElement('div', { id: 'app' }, textEl)

const dom = document.createElement(App.type)
dom.id = App.props.id
const rootEl = document.querySelector('#root')
rootEl.append(dom)

const textNode = document.createTextNode('')
textNode.nodeValue = textEl.props.nodeValue
dom.append(textNode)

```
### åˆ›å»ºrenderå‡½æ•°
```js
function createTextNode (text) {
  return {
    type: 'TEXT_ELEMENT',
    props: {
      nodeValue: text,
      children: []
    }
  }
}

function createElement (type, props, ...children) {
  return {
    type,
    props: {
      ...props,
      children
    }
  }
}
/**
 *
 * @param {*} el
 * @param {*} container
 * 1. åˆ›å»º element
 *
 * 2. props
 * 3. append
 */
function render (el, container) {
  const dom = el.type === 'TEXT_ELEMENT' ? document.createTextNode('') : document.createElement(el.type)
  //props  id class éåŽ†
  Object.keys(el.props).forEach(key => {
    if(key!=="children"){
      dom[key] = el.props[key]
    }
  })
  const children = el.props.children
  children.forEach(child => {
    render(child, dom)
  })

  container.append(dom)
}
const textEl = createTextNode('ðŸ¦‹app')
const App = createElement('div', { id: 'app' }, textEl)

render(App, document.querySelector('#root'))
```
-  ä¼˜åŒ–
```js
...
function createElement (type, props, ...children) {
  return {
    type,
    props: {
      ...props,
      children: children.map(child => typeof child === 'object' ? child : createTextNode(child))
    }
  }
}
...
const App = createElement('div', { id: 'app' }, 'ðŸ¦‹app')
...
```
## ä»»åŠ¡è°ƒåº¦å™¨
```js
let taskId = 1
function workLoop(deadline) {
  taskId++

  let shouldYield = false
  while(!shouldYield) {
    console.log('taskId', taskId)
    shouldYield = deadline.timeRemaining() < 1
  }
  console.log('workLoop', deadline)
  requestIdleCallback(workLoop)
}
requestIdleCallback(workLoop)
```
- ä½¿ç”¨ requestIdleCallback API æ¥ç¡®ä¿ä»»åŠ¡åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æ‰§è¡Œï¼Œä¸ä¼šé˜»å¡žä¸»çº¿ç¨‹
- é€šè¿‡ deadline.timeRemaining() æ¥æ£€æŸ¥å‰©ä½™æ—¶é—´ï¼Œç¡®ä¿ä¸ä¼šå ç”¨å¤ªå¤šæ—¶é—´
- å®žçŽ°äº†æŒç»­è¿è¡Œçš„å·¥ä½œå¾ªçŽ¯ï¼Œæ¯æ¬¡å¾ªçŽ¯éƒ½ä¼šå¢žåŠ ä»»åŠ¡ID
- å½“å‰©ä½™æ—¶é—´ä¸è¶³1æ¯«ç§’æ—¶ï¼Œä¼šæš‚åœå½“å‰å¾ªçŽ¯ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡ç©ºé—²æ—¶é—´
```

## fiber